<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RML Cross-Browser Compatibility Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #f8f9fa;
        }
        
        .browser-info {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .test-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .test-result {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-weight: bold;
        }
        
        .success { background: #d4edda; color: #155724; }
        .warning { background: #fff3cd; color: #856404; }
        .error { background: #f8d7da; color: #721c24; }
        
        .rml-content {
            background: #f8f9fa;
            border: 2px dashed #6c757d;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        
        .rml-output {
            border: 2px solid #28a745;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            background: white;
        }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        
        button:hover {
            background: #0056b3;
        }
        
        .browser-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .browser-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .browser-icon {
            font-size: 2em;
            margin-bottom: 10px;
        }
        
        @media (max-width: 768px) {
            body { padding: 10px; }
            .browser-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <h1>üåê RML Cross-Browser Compatibility Test</h1>
    
    <div class="browser-info">
        <h2>üîç Browser Detection</h2>
        <p><strong>User Agent:</strong> <span id="userAgent"></span></p>
        <p><strong>Detected Browser:</strong> <span id="browserName"></span></p>
        <p><strong>Platform:</strong> <span id="platform"></span></p>
        <p><strong>Mobile:</strong> <span id="isMobile"></span></p>
        <p><strong>Touch Support:</strong> <span id="touchSupport"></span></p>
    </div>
    
    <div class="browser-grid">
        <div class="browser-card">
            <div class="browser-icon">üîµ</div>
            <h3>Chrome</h3>
            <div id="chrome-status" class="test-result">Testing...</div>
        </div>
        
        <div class="browser-card">
            <div class="browser-icon">ü¶ä</div>
            <h3>Firefox</h3>
            <div id="firefox-status" class="test-result">Testing...</div>
        </div>
        
        <div class="browser-card">
            <div class="browser-icon">üî¥</div>
            <h3>Opera</h3>
            <div id="opera-status" class="test-result">Testing...</div>
        </div>
        
        <div class="browser-card">
            <div class="browser-icon">üî∑</div>
            <h3>Edge</h3>
            <div id="edge-status" class="test-result">Testing...</div>
        </div>
        
        <div class="browser-card">
            <div class="browser-icon">üß≠</div>
            <h3>Safari</h3>
            <div id="safari-status" class="test-result">Testing...</div>
        </div>
        
        <div class="browser-card">
            <div class="browser-icon">üì±</div>
            <h3>Mobile</h3>
            <div id="mobile-status" class="test-result">Testing...</div>
        </div>
    </div>
    
    <div class="test-section">
        <h2>üß™ RML Parser Test</h2>
        <p>Testing basic RML syntax parsing:</p>
        
        <div class="rml-content">
            <h3>Input RML:</h3>
            <pre id="rml-input">{title}Hello RML World!{.title}
{text}This is a test of RML parsing across different browsers.{.text}
{success}If you see this styled, RML is working!{.success}
{warning}Cross-browser compatibility test in progress...{.warning}
{lesson}
  {question}Can you see this question box?{.question}
  {answer}If yes, educational tags are working!{.answer}
{.lesson}</pre>
        </div>
        
        <button onclick="testRMLParsing()">üöÄ Test RML Parsing</button>
        <button onclick="testRSSStyles()">üé® Test RSS Styles</button>
        <button onclick="runAllTests()">üîÑ Run All Tests</button>
        
        <div id="rml-output" class="rml-output" style="display: none;">
            <h3>Parsed Output:</h3>
            <div id="parsed-content"></div>
        </div>
    </div>
    
    <div class="test-section">
        <h2>üìä Feature Support Matrix</h2>
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="background: #f8f9fa;">
                    <th style="padding: 10px; border: 1px solid #dee2e6;">Feature</th>
                    <th style="padding: 10px; border: 1px solid #dee2e6;">Status</th>
                    <th style="padding: 10px; border: 1px solid #dee2e6;">Notes</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td style="padding: 10px; border: 1px solid #dee2e6;">Basic RML Parsing</td>
                    <td style="padding: 10px; border: 1px solid #dee2e6;" id="basic-parsing">Testing...</td>
                    <td style="padding: 10px; border: 1px solid #dee2e6;" id="basic-notes">-</td>
                </tr>
                <tr>
                    <td style="padding: 10px; border: 1px solid #dee2e6;">Educational Tags</td>
                    <td style="padding: 10px; border: 1px solid #dee2e6;" id="edu-tags">Testing...</td>
                    <td style="padding: 10px; border: 1px solid #dee2e6;" id="edu-notes">-</td>
                </tr>
                <tr>
                    <td style="padding: 10px; border: 1px solid #dee2e6;">RSS Styling</td>
                    <td style="padding: 10px; border: 1px solid #dee2e6;" id="rss-styling">Testing...</td>
                    <td style="padding: 10px; border: 1px solid #dee2e6;" id="rss-notes">-</td>
                </tr>
                <tr>
                    <td style="padding: 10px; border: 1px solid #dee2e6;">File:// URLs</td>
                    <td style="padding: 10px; border: 1px solid #dee2e6;" id="file-urls">Testing...</td>
                    <td style="padding: 10px; border: 1px solid #dee2e6;" id="file-notes">-</td>
                </tr>
                <tr>
                    <td style="padding: 10px; border: 1px solid #dee2e6;">Extension API</td>
                    <td style="padding: 10px; border: 1px solid #dee2e6;" id="extension-api">Testing...</td>
                    <td style="padding: 10px; border: 1px solid #dee2e6;" id="extension-notes">-</td>
                </tr>
            </tbody>
        </table>
    </div>
    
    <div class="test-section">
        <h2>üéØ Installation Instructions</h2>
        <div id="installation-guide">
            <p>Based on your browser, here's how to install RML support:</p>
            <div id="browser-specific-instructions"></div>
        </div>
    </div>

    <script src="rml-parser.js"></script>
    <script>
        // Browser detection
        function detectBrowser() {
            const ua = navigator.userAgent;
            const platform = navigator.platform;
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(ua);
            const isTablet = /iPad|Android.*(?!.*Mobile)/i.test(ua);
            const touchSupport = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
            
            let browserName = 'Unknown';
            if (ua.includes('Firefox')) browserName = 'Firefox';
            else if (ua.includes('Edg')) browserName = 'Edge';
            else if (ua.includes('OPR') || ua.includes('Opera')) browserName = 'Opera';
            else if (ua.includes('Chrome')) browserName = 'Chrome';
            else if (ua.includes('Safari')) browserName = 'Safari';
            
            return { ua, platform, isMobile, isTablet, touchSupport, browserName };
        }
        
        function updateBrowserInfo() {
            const info = detectBrowser();
            
            document.getElementById('userAgent').textContent = info.ua;
            document.getElementById('browserName').textContent = info.browserName;
            document.getElementById('platform').textContent = info.platform;
            document.getElementById('isMobile').textContent = info.isMobile ? 'Yes' : 'No';
            document.getElementById('touchSupport').textContent = info.touchSupport ? 'Yes' : 'No';
            
            // Update browser status
            const browsers = ['chrome', 'firefox', 'opera', 'edge', 'safari', 'mobile'];
            browsers.forEach(browser => {
                const element = document.getElementById(`${browser}-status`);
                if (browser === info.browserName.toLowerCase() || 
                    (browser === 'mobile' && info.isMobile)) {
                    element.textContent = 'Current Browser';
                    element.className = 'test-result success';
                } else {
                    element.textContent = 'Not Active';
                    element.className = 'test-result warning';
                }
            });
        }
        
        function testRMLParsing() {
            try {
                const inputElement = document.getElementById('rml-input');
                const outputElement = document.getElementById('rml-output');
                const contentElement = document.getElementById('parsed-content');
                
                const rmlContent = inputElement.textContent;
                
                if (typeof RMLParser === 'undefined') {
                    throw new Error('RMLParser not found - extension may not be loaded');
                }
                
                const parser = new RMLParser();
                const htmlContent = parser.parse(rmlContent);
                
                contentElement.innerHTML = htmlContent;
                outputElement.style.display = 'block';
                
                updateFeatureStatus('basic-parsing', 'success', '‚úÖ Working', 'Parser loaded and functioning');
                updateFeatureStatus('edu-tags', 'success', '‚úÖ Working', 'Educational tags rendering correctly');
                
                console.log('‚úÖ RML parsing test successful!');
                
            } catch (error) {
                console.error('‚ùå RML parsing test failed:', error);
                updateFeatureStatus('basic-parsing', 'error', '‚ùå Failed', error.message);
                updateFeatureStatus('edu-tags', 'error', '‚ùå Failed', 'Dependent on basic parsing');
            }
        }
        
        function testRSSStyles() {
            try {
                const testContent = '{text}[color: blue;]Blue text[size: large;]{.text}';
                
                if (typeof RMLParser === 'undefined') {
                    throw new Error('RMLParser not found');
                }
                
                const parser = new RMLParser();
                const htmlContent = parser.parse(testContent);
                
                if (htmlContent.includes('style=') || htmlContent.includes('color') || htmlContent.includes('font-size')) {
                    updateFeatureStatus('rss-styling', 'success', '‚úÖ Working', 'RSS styles are being applied');
                } else {
                    updateFeatureStatus('rss-styling', 'warning', '‚ö†Ô∏è Partial', 'RSS styles may not be fully supported');
                }
                
            } catch (error) {
                updateFeatureStatus('rss-styling', 'error', '‚ùå Failed', error.message);
            }
        }
        
        function testExtensionAPI() {
            try {
                const hasChrome = typeof chrome !== 'undefined' && chrome.runtime;
                const hasBrowser = typeof browser !== 'undefined' && browser.runtime;
                const hasExtension = hasChrome || hasBrowser;
                
                if (hasExtension) {
                    updateFeatureStatus('extension-api', 'success', '‚úÖ Available', 'Extension API detected');
                } else {
                    updateFeatureStatus('extension-api', 'warning', '‚ö†Ô∏è Not Available', 'Running as standalone script');
                }
                
                // Test file:// URL support
                if (window.location.protocol === 'file:') {
                    updateFeatureStatus('file-urls', 'success', '‚úÖ Working', 'File:// URL access working');
                } else {
                    updateFeatureStatus('file-urls', 'warning', '‚ö†Ô∏è Not Tested', 'Not a file:// URL');
                }
                
            } catch (error) {
                updateFeatureStatus('extension-api', 'error', '‚ùå Failed', error.message);
            }
        }
        
        function updateFeatureStatus(feature, status, text, notes) {
            const statusElement = document.getElementById(feature);
            const notesElement = document.getElementById(feature.replace('-', '-') + '-notes');
            
            if (statusElement) {
                statusElement.textContent = text;
                statusElement.className = `test-result ${status}`;
            }
            
            if (notesElement) {
                notesElement.textContent = notes;
            }
        }
        
        function updateInstallationGuide() {
            const info = detectBrowser();
            const instructionsElement = document.getElementById('browser-specific-instructions');
            
            let instructions = '';
            
            switch (info.browserName) {
                case 'Chrome':
                    instructions = `
                        <div class="test-result success">
                            <strong>Chrome Installation:</strong><br>
                            1. Go to chrome://extensions/<br>
                            2. Enable "Developer mode"<br>
                            3. Click "Load unpacked"<br>
                            4. Select the chrome-extension/ folder
                        </div>
                    `;
                    break;
                    
                case 'Firefox':
                    instructions = `
                        <div class="test-result success">
                            <strong>Firefox Installation:</strong><br>
                            1. Go to about:debugging<br>
                            2. Click "This Firefox"<br>
                            3. Click "Load Temporary Add-on"<br>
                            4. Select manifest.json from firefox-extension/ folder
                        </div>
                    `;
                    break;
                    
                case 'Opera':
                    instructions = `
                        <div class="test-result success">
                            <strong>Opera Installation:</strong><br>
                            1. Go to opera://extensions/<br>
                            2. Enable "Developer mode"<br>
                            3. Click "Load unpacked"<br>
                            4. Select the chrome-extension/ folder (Chrome compatible)
                        </div>
                    `;
                    break;
                    
                case 'Edge':
                    instructions = `
                        <div class="test-result success">
                            <strong>Edge Installation:</strong><br>
                            1. Go to edge://extensions/<br>
                            2. Enable "Developer mode"<br>
                            3. Click "Load unpacked"<br>
                            4. Select the chrome-extension/ folder (Chrome compatible)
                        </div>
                    `;
                    break;
                    
                case 'Safari':
                    instructions = `
                        <div class="test-result warning">
                            <strong>Safari Installation:</strong><br>
                            1. Install Tampermonkey from Safari Extensions<br>
                            2. Add the RML UserScript (safari-extension/rml-userscript.js)<br>
                            3. Enable the script for .rml files<br>
                            Note: Limited functionality compared to other browsers
                        </div>
                    `;
                    break;
                    
                default:
                    instructions = `
                        <div class="test-result warning">
                            <strong>Universal Installation:</strong><br>
                            Your browser may support WebExtensions. Try:<br>
                            1. Use the universal-extension/ folder<br>
                            2. Or include rml-parser.js manually in your pages<br>
                            3. For mobile: use mobile-browsers/rml-mobile.js
                        </div>
                    `;
            }
            
            if (info.isMobile) {
                instructions += `
                    <div class="test-result warning">
                        <strong>Mobile Browser:</strong><br>
                        Extension support is limited on mobile. Consider:<br>
                        1. Using the mobile-optimized script (rml-mobile.js)<br>
                        2. Firefox Mobile supports some extensions<br>
                        3. Kiwi Browser (Android) supports Chrome extensions
                    </div>
                `;
            }
            
            instructionsElement.innerHTML = instructions;
        }
        
        function runAllTests() {
            console.log('üîÑ Running all RML compatibility tests...');
            
            updateBrowserInfo();
            testRMLParsing();
            testRSSStyles();
            testExtensionAPI();
            updateInstallationGuide();
            
            console.log('‚úÖ All tests completed!');
        }
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ RML Cross-Browser Test Page Loaded!');
            runAllTests();
        });
        
        // Auto-run tests every 30 seconds to catch dynamic loading
        setInterval(runAllTests, 30000);
        
    </script>
</body>
</html> 